# https://www.mickaelvieira.com/blog/2020/01/29/deploying-a-static-website-to-google-cloud-storage-with-github-actions.html

name: GSP - Push Repo # name of your workflow
on:
  push:
    branches:
      - master # Deployment will be triggered when we will push to the master branch
jobs:
  name: Push to GCS
  runs-on: ubuntu-latest
    steps:
      uses: google-github-actions/auth@v0
      with:
        service_account: '${{ secrets.GCP_SA_EMAIL }}'
        credentials_json: '${{ secrets.GCP_SA_KEY }}'
    
      uses: google-github-actions/setup-gcloud@v0


      uses: actions/checkout@v1
      with:
        ref: refs/heads/master
        fetch-depth: 1
      run: gsutil -m rsync -d -c -r public gs://my-gcs-bucket
      run: gsutil -m setmeta -h "Cache-Control:public, max-age=3600" gs://my-gcs-bucket/**/*.html
      run: gsutil -m setmeta -h "Cache-Control:public, max-age=31536000" gs://my-gcs-bucket/js/*.js
      run: gsutil -m setmeta -h "Cache-Control:public, max-age=31536000" gs://my-gcs-bucket/css/*.css
